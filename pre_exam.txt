Mon Dec 12 01:29:31 EET 2022
+ hostname
MacBook-Pro-2.lan
+ ansible-playbook infra.yaml --diff

PLAY [Operations on local machine] *********************************************

PLAY [Swap db master and slave] ************************************************

PLAY [Gather facts] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

PLAY [Remote hosts setup] ******************************************************

TASK [remote_hosts : Update and upgrade apt packages] **************************
changed: [binary0ne-1]
changed: [binary0ne-3]
changed: [binary0ne-2]

TASK [remote_hosts : Update CA certificates] ***********************************
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-3]
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-1]
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-2]

TASK [node_exporter : Installing Prometheus node exporter] *********************
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-1]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-3]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-2]

TASK [backup : Add backup group] ***********************************************
ok: [binary0ne-2]
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [backup : Add backup user] ************************************************
changed: [binary0ne-1]
changed: [binary0ne-3]
changed: [binary0ne-2]

TASK [backup : Ensure .ssh exists] *********************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/home/backup/.ssh",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/home/backup/.ssh",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-3]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/home/backup/.ssh",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-2]

TASK [backup : Generate keypair] ***********************************************
--- before
+++ after
@@ -1 +1,7 @@
-{}
+{
+    "comment": "",
+    "fingerprint": "SHA256:TSyXo5/Mu4L6NBTUhkHJcfEgCGNO9FxX1vigjhk0/VU",
+    "public_key": "AAAAB3NzaC1yc2EAAAADAQABAAACAQC+JzunUPPyUWIXdEJfb+lCwj0St8306HOP8Hub16ByeTcAjAoo0qs0GZNZOm5yawIYTZ5SToRWY8DPKhQAHJ4YEr5q5zBy1paOySM6P9XdT1whI+wjnFBEmnFE6fqjALDbe3APzRcwbZqxYyqXR6+KD/KYIQU3UmQ0cSF5kdOkBCgLcS0sPxdoEd+yf/XiGDGpzaEYFjpTjgW7qaKD5REsTZEX1DW51dCYQJ0x0LBkTWNNT14hFpB+jBWIa8+YwOhnZ5pVfa0q/qZICLXbpSfhlV1ftcIpX29XAjvMR0skpItsfs/+7/aYGM/DUSIBhAbShSkb2+mlPUWPBq2h6jF7B1M24y1QU270BYE1sUhmsHRHO6cC2V+5idtnjgr7dDSbTcK22E4nJWi/O59DnYePELiyLXjAfccpMh43zqLx/+YfoNsdPNQflRvqYDTQlUn12hJFWhmVM2HmFsKi8T7sd0UPK0ztx+BC754dtU7dUVuI4snjcgybgrRvHgk3RvuuYBV2AUspOYzf2Z5QyXImsivZzDoAr1UZpIGbItSvj3jKh6UnHt8vDnKmpg/Ie9Sq0u22KMMwDpGCAgbMdxYjvjAx2dAaPRW/KmZSMSSkkANyFCZsWrN9qVP3LXu1rwXTL9OCnpqO8fW+kLtvZ6waRYn90yyytLCE3OFDBpWRDw==",
+    "size": 4096,
+    "type": "rsa"
+}

changed: [binary0ne-1]
--- before
+++ after
@@ -1 +1,7 @@
-{}
+{
+    "comment": "",
+    "fingerprint": "SHA256:dHi65uPCplmKmtuVV/+WAobEqZBElitEGLnLnXoZA4o",
+    "public_key": "AAAAB3NzaC1yc2EAAAADAQABAAACAQDJR6NzEnSfGSe3pwMRfTcYW1lHCTXgz0ULHFXrFNAFew9d2Y0HYO/fcIK6kiJl9ccjOzmr0VWKlwYDYn/RjR80t85Z52H+F6eZ7MH5Ijai5S/hnasyaEWl0f8fKyMkTzx57yTdTTidJDoXiKS6gBREM70+ojvG1ZNEpSeA/NVGsykvmyoVf1luKlXWrHFvhe6HIfAWABtzw6Ia6xyvvQfHKb+jiQ91aJHVjCBQwsNWymLxqs/0vW8mD4bGmT+NhKSC7Odm9JHI0AMvzDw0PAa9zMUmThkqiZcmX0888Y6xHAB7EaMfJTNJ0f2P7KOUEKFsf/xKb+W+fmQDQ9uJMWc0TTJtXh9pelWUvuwvS3DSxxKb2v1xvHR+rSJICSWCd6aBVocu19hhCkhZXrAvNTrPtFXdUpX/v0PNoAUcV94ZsACGB7VJXIMFtGrbraOZoGmp9yzdBvwSAlNBPxJqbVtNiEwC4Pfq5AmWMOgaEwrN/+vTRDnLjf74iMThFk8co+cKjD+5GOEX7Wb5RULKTwbwxLEIS8je1BxGeaEEb3bcChDz1pyLyPIEaEgacYjE/2t/mSLHoLbKCOsvir+48f//D/i92wFx+Ii2rGLFadtmsDeT1NNJHcpWY7aX0acN+JAwEl0J6U6sVDzpa74NSClIlRxFTcyApnlWFUN5KRjocw==",
+    "size": 4096,
+    "type": "rsa"
+}

changed: [binary0ne-2]
--- before
+++ after
@@ -1 +1,7 @@
-{}
+{
+    "comment": "",
+    "fingerprint": "SHA256:piz12dQwq09JdwCwdoWVZpy7BN9c+tGC2w8W+4hIDcA",
+    "public_key": "AAAAB3NzaC1yc2EAAAADAQABAAACAQCXrYvmS1Ri1JCkN9kUzru0V2JoRSe8hSeVNleEhJCcg5fRZOMVLwfCp5cNIxaxFWls9GapdvnPlXHDyz+Q8bb9u741Uyphj37ktoTBd8T0ryNDxmOGzEuInS05iyqIylpLKgIyauz+hgUQTwdLt45N/JinJUFW099hj4Yw7YN6rLWoAaLQb4FkHA/e3HqPUwttYEnwuGiZ6EA9GcYfjVkHpg2sCj0sU3WepPTFsIxb0/k6H49eAeC9UGc/h0jE1hluS+Wu2cONKeANJo9BinmktLMt0PNRQYbiwHWWlRUnKkZgHXY2w9YzpUXtfQ060BZBAj0KdHIQjJZg0DP2uxCfsDvIptmmA+c5OIynUwbcjtV35vCcm7i46cCu5Hbm1ksv+pmSkg7vF5SQpnNk6RlR6+QUeElW73zc8nFHDGN6HYEhIZ8gxGqAZbSyVFYRItHtG4kMjieAOos5WLaaszB57C90vobRhYs9/4w+/HVOs7hI35G3v0M3Jt8QXF1GVgEDjJutHYv4dK/2x4GwHnphSpop/9goHDXXgGiimVPOpwh00T8EHhRZBEMuTxjajJ3D5rDWkU0Kman+qW6Mkab+t+t4tmRu2DPMWLNpbJ3qJ29RL3bn4aLkrV/SgVhShfKejHWovhQnnOP7I/PlwL8twqCeKdEyI0q4D/2/TCVJAw==",
+    "size": 4096,
+    "type": "rsa"
+}

changed: [binary0ne-3]

TASK [backup : Change ownership] ***********************************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/.ssh/id_rsa"
 }

changed: [binary0ne-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/.ssh/id_rsa"
 }

changed: [binary0ne-2]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/.ssh/id_rsa"
 }

changed: [binary0ne-3]

TASK [backup : Add SSH keys for users] *****************************************
--- before: /home/backup/.ssh/authorized_keys
+++ after: /home/backup/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90 

changed: [binary0ne-3]
--- before: /home/backup/.ssh/authorized_keys
+++ after: /home/backup/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90 

changed: [binary0ne-2]
--- before: /home/backup/.ssh/authorized_keys
+++ after: /home/backup/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90 

changed: [binary0ne-1]

TASK [backup : Add to known hosts] *********************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpr0zmrkrr/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.slaanesh.cult ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmplkqce1i4/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.slaanesh.cult ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [binary0ne-2]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpmeobxdwt/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.slaanesh.cult ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [binary0ne-3]

TASK [backup : Ensure restore folder is created] *******************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-1]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-2]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-3]

TASK [backup : Install duplicity] **********************************************
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-2]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-1]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [binary0ne-3]

RUNNING HANDLER [node_exporter : Run node exporter] ****************************
ok: [binary0ne-3]
ok: [binary0ne-1]
ok: [binary0ne-2]

PLAY [DNS server] **************************************************************

TASK [bind : Install bind] *****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 4 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 4 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 4 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]

TASK [bind : Install python dependencies] **************************************
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]

TASK [bind : Update bind config] ***********************************************
--- before: /etc/bind/named.conf.options
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmppjwfpl9g/named.conf.options.j2
@@ -1,24 +1,47 @@
+acl trusted { 192.168.42.0/24; 192.168.42.0/24; 192.168.42.0/24; 127.0.0.0/8; 172.17.0.0/16; };
+key "transfer.key" {
+        algorithm hmac-sha256;
+        secret "SECRET";
+};
+
+key "rndc-key" {
+        algorithm hmac-sha256;
+        secret "SECRET";
+};
+
 options {
-	directory "/var/cache/bind";
+    directory "/var/cache/bind";
+        allow-query { trusted; };
+    recursion yes;
+    allow-recursion { trusted; };
+    forwarders {
+        8.8.8.8;
+        8.8.4.4;
+    };
+};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
+statistics-channels {
+  inet 127.0.0.1 port 8053 allow { 127.0.0.1; };
+};
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+zone "slaanesh.cult" {
+    type slave;
+    file "/var/cache/bind/zones/slaanesh.cult.db";
+    
+        masters {
+                192.168.42.143;
+    };
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
+zone "168.192.in-addr.arpa" {
+    type slave;
+    file "/var/cache/bind/zones/slaanesh.cult.rev";
+    
+        masters {
+                192.168.42.143;
+    };
+};
 
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+server 192.168.42.143 {
+    keys { transfer.key; };
 };

changed: [binary0ne-3]
--- before: /etc/bind/named.conf.options
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpp9f6ifhy/named.conf.options.j2
@@ -1,24 +1,47 @@
+acl trusted { 192.168.42.0/24; 192.168.42.0/24; 192.168.42.0/24; 127.0.0.0/8; 172.17.0.0/16; };
+key "transfer.key" {
+        algorithm hmac-sha256;
+        secret "SECRET";
+};
+
+key "rndc-key" {
+        algorithm hmac-sha256;
+        secret "SECRET";
+};
+
 options {
-	directory "/var/cache/bind";
+    directory "/var/cache/bind";
+        allow-query { trusted; };
+    recursion yes;
+    allow-recursion { trusted; };
+    forwarders {
+        8.8.8.8;
+        8.8.4.4;
+    };
+};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
+statistics-channels {
+  inet 127.0.0.1 port 8053 allow { 127.0.0.1; };
+};
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+zone "slaanesh.cult" {
+    type slave;
+    file "/var/cache/bind/zones/slaanesh.cult.db";
+    
+        masters {
+                192.168.42.143;
+    };
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
+zone "168.192.in-addr.arpa" {
+    type slave;
+    file "/var/cache/bind/zones/slaanesh.cult.rev";
+    
+        masters {
+                192.168.42.143;
+    };
+};
 
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+server 192.168.42.143 {
+    keys { transfer.key; };
 };

changed: [binary0ne-1]
--- before: /etc/bind/named.conf.options
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp2ixrwl0i/named.conf.options.j2
@@ -1,24 +1,40 @@
+acl trusted { 192.168.42.0/24; 192.168.42.0/24; 192.168.42.0/24; 127.0.0.0/8; 172.17.0.0/16; };
+key "transfer.key" {
+        algorithm hmac-sha256;
+        secret "SECRET";
+};
+
+key "rndc-key" {
+        algorithm hmac-sha256;
+        secret "SECRET";
+};
+
 options {
-	directory "/var/cache/bind";
+    directory "/var/cache/bind";
+    also-notify { 192.168.42.32; 192.168.42.156;  };    allow-query { trusted; };
+    recursion yes;
+    allow-recursion { trusted; };
+    forwarders {
+        8.8.8.8;
+        8.8.4.4;
+    };
+};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
+statistics-channels {
+  inet 127.0.0.1 port 8053 allow { 127.0.0.1; };
+};
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+zone "slaanesh.cult" {
+    type master;
+    file "/var/cache/bind/zones/slaanesh.cult.db";
+    allow-transfer { key "transfer.key"; };
+    allow-update { key "rndc-key"; };    
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
+zone "168.192.in-addr.arpa" {
+    type master;
+    file "/var/cache/bind/zones/slaanesh.cult.rev";
+    allow-transfer { key "transfer.key"; };
+    allow-update { key "rndc-key"; };    
+};
 
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
-};

changed: [binary0ne-2]

TASK [bind : Creates zone directory] *******************************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 120,
+    "owner": 113,
     "path": "/var/cache/bind/zones",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-2]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 120,
+    "owner": 113,
     "path": "/var/cache/bind/zones",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-1]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 120,
+    "owner": 113,
     "path": "/var/cache/bind/zones",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-3]

RUNNING HANDLER [bind : Start bind] ********************************************
ok: [binary0ne-3]
ok: [binary0ne-2]
ok: [binary0ne-1]

RUNNING HANDLER [bind : Restart bind] ******************************************
changed: [binary0ne-1]
changed: [binary0ne-3]
changed: [binary0ne-2]

PLAY [Provide initial dns config] **********************************************

TASK [nsstaticconf : Update zones config] **************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpd8lrb203/zone.db.j2
@@ -0,0 +1,15 @@
+$TTL	604800
+slaanesh.cult.       IN      SOA     binary0ne-2.slaanesh.cult. admin.slaanesh.cult. (
+                              5         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+slaanesh.cult.     IN      NS      binary0ne-2
+slaanesh.cult.     IN      NS      binary0ne-1
+slaanesh.cult.     IN      NS      binary0ne-3
+
+binary0ne-2     IN      A      192.168.42.143
+binary0ne-1     IN      A      192.168.42.32
+binary0ne-3     IN      A      192.168.42.156
+

changed: [binary0ne-2]

TASK [nsstaticconf : Update reverse config] ************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmphwfasch4/zone.rev.j2
@@ -0,0 +1,17 @@
+$TTL	604800
+168.192.in-addr.arpa.       IN      SOA     ns1.slaanesh.cult. admin.slaanesh.cult. (
+                              5         ; Serial
+                         604800         ; Refresh
+                          86400         ; Retry
+                        2419200         ; Expire
+                         604800 )       ; Negative Cache TTL
+
+168.192.in-addr.arpa.     IN      NS      ns1.slaanesh.cult.
+168.192.in-addr.arpa.     IN      NS      ns2.slaanesh.cult.
+168.192.in-addr.arpa.     IN      NS      ns3.slaanesh.cult.
+
+32.42    IN    PTR    binary0ne-1.slaanesh.cult.
+143.42    IN    PTR    binary0ne-2.slaanesh.cult.
+156.42    IN    PTR    binary0ne-3.slaanesh.cult.
+
+

changed: [binary0ne-2]

RUNNING HANDLER [nsstaticconf : Restart bind] **********************************
changed: [binary0ne-2]

PLAY [Update ns records] *******************************************************

TASK [nsstaticconf : Update zones config] **************************************
ok: [binary0ne-2]

TASK [nsstaticconf : Update reverse config] ************************************
ok: [binary0ne-2]

TASK [nsupdate : Prepare vars] *************************************************
ok: [binary0ne-2 -> localhost]

TASK [nsupdate : Add new hosts] ************************************************
ok: [binary0ne-2]

TASK [nsupdate : Install python dependencies] **********************************
ok: [binary0ne-2]

TASK [nsupdate : Add dns records] **********************************************
changed: [binary0ne-2] => (item={'name': 'backup', 'address': '192.168.42.132', 'type': 'A'})
changed: [binary0ne-2] => (item={'name': 'grafana', 'address': 'binary0ne-2', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'influxdb', 'address': 'binary0ne-2', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'lb1', 'address': 'binary0ne-1', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'lb2', 'address': 'binary0ne-3', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'mysql1', 'address': 'binary0ne-1', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'mysql2', 'address': 'binary0ne-3', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'ns1', 'address': 'binary0ne-2', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'ns2', 'address': 'binary0ne-1', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'ns3', 'address': 'binary0ne-3', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'prometheus', 'address': 'binary0ne-2', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'web1', 'address': 'binary0ne-1', 'type': 'CNAME'})
changed: [binary0ne-2] => (item={'name': 'web2', 'address': 'binary0ne-3', 'type': 'CNAME'})

PLAY [Update for dns server] ***************************************************

TASK [remote_network : Updating DNS server path] *******************************
--- before: /etc/resolv.conf
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpt5ud3zlp/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+search slaanesh.cult
+nameserver 192.168.42.32
+nameserver 192.168.42.156

changed: [binary0ne-1]
--- before: /etc/resolv.conf
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp9gr1uwro/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+search slaanesh.cult
+nameserver 192.168.42.32
+nameserver 192.168.42.156

changed: [binary0ne-3]
--- before: /etc/resolv.conf
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpwarsru93/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+search slaanesh.cult
+nameserver 192.168.42.32
+nameserver 192.168.42.156

changed: [binary0ne-2]

PLAY [Nginx for monitoring] ****************************************************

TASK [nginx : Install nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

TASK [nginx : Upload nginx config] *********************************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp6fbsaz6v/default.j2
@@ -1,91 +1,26 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+	location /prometheus {
+		proxy_pass http://localhost:9090;
 	}
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+    location /metrics {
+		proxy_pass http://localhost:9100/metrics;
+	}
+    location /grafana {
+        proxy_set_header Host $http_host;
+        proxy_pass http://localhost:3001;
+    }
 }
 
+server {
+	listen 127.0.0.1:8080;
+	server_name _;
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+    location = /stub_status {
+        stub_status;
+    }
+}

changed: [binary0ne-2]

RUNNING HANDLER [nginx : Run Nginx] ********************************************
ok: [binary0ne-2]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [binary0ne-2]

PLAY [Grafana] *****************************************************************

TASK [docker : Install docker (and save the God all of us!)] *******************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz runc ubuntu-fan
0 upgraded, 8 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

TASK [docker : Install pyhon3-docker] ******************************************
The following additional packages will be installed:
  python3-websocket
The following NEW packages will be installed:
  python3-docker python3-websocket
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

TASK [grafana : Get grafana structure vars] ************************************
ok: [binary0ne-2]

TASK [grafana : Get public ips] ************************************************
ok: [binary0ne-2]

TASK [grafana : Create grafana directories] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-2] => (item=provisioning/dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-2] => (item=provisioning/datasources)

TASK [grafana : Create grafana files] ******************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpj3jzr_sj/grafana.ini.j2
@@ -0,0 +1,12 @@
+[server]
+domain = 193.40.156.67
+root_url = http://193.40.156.67:3000/grafana/
+serve_from_sub_path = true
+
+[security]
+admin_password = SUPERPASSWORD
+
+
+
+
+

changed: [binary0ne-2] => (item=grafana.ini)
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpdkwujmu6/provisioning.yaml.j2
@@ -0,0 +1,9 @@
+apiVersion: 1
+
+providers:
+  - name: dashboards
+    type: file
+    updateIntervalSeconds: 30
+    options:
+      path: /etc/grafana/provisioning/dashboards
+      foldersFromFilesStructure: true
\ No newline at end of file

changed: [binary0ne-2] => (item=provisioning/dashboards/provisioning.yaml)
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpu0jzrf1_/main.json.j2
@@ -0,0 +1,1414 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "collapsed": true,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "id": 24,
+      "panels": [],
+      "title": "Influx",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P9A10D1B1B3C69CBE"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 1
+      },
+      "id": 26,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P9A10D1B1B3C69CBE"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "dst"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "hide": false,
+          "measurement": "rtt",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "mean"
+              }
+            ]
+          ],
+          "tags": []
+        }
+      ],
+      "title": "pings",
+      "transformations": [
+        {
+          "id": "labelsToFields",
+          "options": {
+            "mode": "columns",
+            "valueLabel": "dst"
+          }
+        }
+      ],
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "PCAC1136F1F038CF9"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "debug"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "yellow",
+                  "mode": "fixed"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "info"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "green",
+                  "mode": "fixed"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "notice"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "blue",
+                  "mode": "fixed"
+                }
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 1
+      },
+      "id": 28,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PCAC1136F1F038CF9"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "severity"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "hostname"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "query": "SELECT count(\"message\") FROM \"syslog\" WHERE $timeFilter GROUP BY time($__interval), \"severity\"",
+          "rawQuery": true,
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "message"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": []
+        },
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PCAC1136F1F038CF9"
+          },
+          "hide": false,
+          "refId": "B"
+        }
+      ],
+      "title": "log types",
+      "transformations": [
+        {
+          "id": "labelsToFields",
+          "options": {
+            "keepLabels": [
+              "severity"
+            ],
+            "mode": "columns",
+            "valueLabel": "severity"
+          }
+        }
+      ],
+      "type": "timeseries"
+    },
+    {
+      "collapsed": false,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 9
+      },
+      "id": 17,
+      "panels": [],
+      "title": "Services",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 0,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 1,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 0,
+        "y": 10
+      },
+      "id": 13,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "builder",
+          "expr": "mysql_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL",
+      "transformations": [],
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 6,
+        "y": 10
+      },
+      "id": 19,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "builder",
+          "expr": "bind_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 12,
+        "y": 10
+      },
+      "id": 29,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "nginx_up{instance=\"binary0ne-1:9113\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "WEB Server",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 18,
+        "y": 10
+      },
+      "id": 21,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "influxdb_exporter_stats_query_success",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "InfluxDB",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 0,
+        "y": 13
+      },
+      "id": 11,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(mysql_global_status_commands_total{command=\"select\"}[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "selects/m",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 6,
+        "y": 13
+      },
+      "id": 20,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(bind_resolver_queries_total[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "queries/m",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 12,
+        "y": 13
+      },
+      "id": 22,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(nginx_http_requests_total{instance=\"binary0ne-1:9113\"}[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "requests/m",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 6,
+        "x": 18,
+        "y": 13
+      },
+      "id": 30,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "influxdb_write_write_ok{instance=\"binary0ne-1:9424\"}",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "writes",
+      "type": "stat"
+    },
+    {
+      "collapsed": false,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 16
+      },
+      "id": 15,
+      "panels": [],
+      "title": "CPU/RAM",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 100,
+            "axisSoftMin": 0,
+            "barAlignment": 0,
+            "drawStyle": "bars",
+            "fillOpacity": 100,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 0,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 12,
+        "x": 0,
+        "y": 17
+      },
+      "id": 8,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": false
+        },
+        "tooltip": {
+          "mode": "none",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum((avg by (instance, mode) (irate(node_cpu_seconds_total{mode!='idle', instance=\"binary0ne-1:9100\"}[30s])) * 100))",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "binary0ne-1 CPU",
+      "transparent": true,
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 100,
+            "axisSoftMin": 0,
+            "barAlignment": 0,
+            "drawStyle": "bars",
+            "fillOpacity": 100,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 12,
+        "x": 12,
+        "y": 17
+      },
+      "id": 9,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": false
+        },
+        "tooltip": {
+          "mode": "none",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "9.2.6",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum((avg by (instance, mode) (irate(node_cpu_seconds_total{mode!='idle', instance=\"binary0ne-2:9100\"}[30s])) * 100))",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "binary0ne-2 CPU",
+      "transparent": true,
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 100,
+            "axisSoftMin": 0,
+            "barAlignment": 0,
+            "drawStyle": "bars",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "__systemRef": "hideSeriesFrom",
+            "matcher": {
+              "id": "byNames",
+              "options": {
+                "mode": "exclude",
+                "names": [
+                  "{instance=\"binary0ne-1:9100\", job=\"linux\"}"
+                ],
+                "prefix": "All except:",
+                "readOnly": true
+              }
+            },
+            "properties": [
+              {
+                "id": "custom.hideFrom",
+                "value": {
+                  "legend": false,
+                  "tooltip": false,
+                  "viz": true
+                }
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 12,
+        "x": 0,
+        "y": 23
+      },
+      "id": 5,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": false
+        },
+        "tooltip": {
+          "mode": "none",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "(100 * (1 - ((avg_over_time (node_memory_MemFree_bytes[30s]) + avg_over_time(node_memory_Cached_bytes[30s]) + avg_over_time(node_memory_Buffers_bytes[30s])) / avg_over_time(node_memory_MemTotal_bytes[30s]))))",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "binary0ne-1 RAM",
+      "transformations": [],
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 100,
+            "axisSoftMin": 0,
+            "barAlignment": 0,
+            "drawStyle": "bars",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "__systemRef": "hideSeriesFrom",
+            "matcher": {
+              "id": "byNames",
+              "options": {
+                "mode": "exclude",
+                "names": [
+                  "{instance=\"binary0ne-2:9100\", job=\"linux\"}"
+                ],
+                "prefix": "All except:",
+                "readOnly": true
+              }
+            },
+            "properties": [
+              {
+                "id": "custom.hideFrom",
+                "value": {
+                  "legend": false,
+                  "tooltip": false,
+                  "viz": true
+                }
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 12,
+        "x": 12,
+        "y": 23
+      },
+      "id": 6,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": false
+        },
+        "tooltip": {
+          "mode": "none",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "(100 * (1 - ((avg_over_time (node_memory_MemFree_bytes[30s]) + avg_over_time(node_memory_Cached_bytes[30s]) + avg_over_time(node_memory_Buffers_bytes[30s])) / avg_over_time(node_memory_MemTotal_bytes[30s]))))",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "binary0ne-2 RAM",
+      "transformations": [],
+      "type": "timeseries"
+    }
+  ],
+  "refresh": "5s",
+  "schemaVersion": 37,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-5m",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "Main",
+  "uid": "cwPmiRF4z",
+  "version": 5,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [binary0ne-2] => (item=provisioning/dashboards/main.json)
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpxp589i2l/mysql.json.j2
@@ -0,0 +1,1969 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "collapsed": false,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "id": 42,
+      "panels": [],
+      "title": "Row title",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 6,
+        "x": 0,
+        "y": 1
+      },
+      "id": 44,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "haproxy_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "HAproxy status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                }
+              },
+              "type": "value"
+            },
+            {
+              "options": {
+                "from": 1,
+                "result": {
+                  "index": 0,
+                  "text": "up"
+                },
+                "to": 2
+              },
+              "type": "range"
+            }
+          ],
+          "noValue": "0",
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 6,
+        "x": 6,
+        "y": 1
+      },
+      "id": 46,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "count  by (server) (haproxy_server_up)",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Docker conatiners",
+      "transformations": [
+        {
+          "id": "labelsToFields",
+          "options": {
+            "mode": "columns",
+            "valueLabel": "server"
+          }
+        }
+      ],
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "decimals": 0,
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 2,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 1,
+                  "text": "standby"
+                },
+                "2": {
+                  "index": 0,
+                  "text": "active"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "max": 2,
+          "min": 0,
+          "noValue": "0",
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 12,
+        "x": 12,
+        "y": 1
+      },
+      "id": 48,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "keepalived_vrrp_state",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "VRRP state",
+      "transformations": [
+        {
+          "id": "labelsToFields",
+          "options": {
+            "valueLabel": "instance"
+          }
+        }
+      ],
+      "type": "timeseries"
+    },
+    {
+      "collapsed": true,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 5
+      },
+      "id": 32,
+      "panels": [],
+      "title": "MySQL",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 5,
+        "x": 0,
+        "y": 6
+      },
+      "id": 34,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_variables_server_id",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "SQL id",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "no"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "yes"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 5,
+        "x": 5,
+        "y": 6
+      },
+      "id": 36,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_variables_read_only",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Read_only",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 5,
+        "x": 10,
+        "y": 6
+      },
+      "id": 38,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_io_running",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "SlaveIO",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 5,
+        "x": 15,
+        "y": 6
+      },
+      "id": 40,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_sql_running",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "SlaveSQL",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 0,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 1,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 4,
+        "x": 20,
+        "y": 6
+      },
+      "id": 13,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "builder",
+          "expr": "mysql_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL",
+      "transformations": [],
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 4,
+        "x": 20,
+        "y": 9
+      },
+      "id": 11,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(mysql_global_status_commands_total{command=\"select\"}[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "selects/m",
+      "type": "stat"
+    },
+    {
+      "collapsed": false,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 12
+      },
+      "id": 17,
+      "panels": [],
+      "title": "Services",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P9A10D1B1B3C69CBE"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 3,
+        "x": 0,
+        "y": 13
+      },
+      "id": 26,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P9A10D1B1B3C69CBE"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "dst"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "hide": false,
+          "measurement": "rtt",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "mean"
+              }
+            ]
+          ],
+          "tags": []
+        }
+      ],
+      "title": "pings",
+      "transformations": [
+        {
+          "id": "labelsToFields",
+          "options": {
+            "mode": "columns",
+            "valueLabel": "dst"
+          }
+        }
+      ],
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "PCAC1136F1F038CF9"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "debug"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "yellow",
+                  "mode": "fixed"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "info"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "green",
+                  "mode": "fixed"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "notice"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "blue",
+                  "mode": "fixed"
+                }
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 3,
+        "x": 3,
+        "y": 13
+      },
+      "id": 28,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PCAC1136F1F038CF9"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "$__interval"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "severity"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "hostname"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "query": "SELECT count(\"message\") FROM \"syslog\" WHERE $timeFilter GROUP BY time($__interval), \"severity\"",
+          "rawQuery": true,
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "message"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": []
+        },
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PCAC1136F1F038CF9"
+          },
+          "hide": false,
+          "refId": "B"
+        }
+      ],
+      "title": "log types",
+      "transformations": [
+        {
+          "id": "labelsToFields",
+          "options": {
+            "keepLabels": [
+              "severity"
+            ],
+            "mode": "columns",
+            "valueLabel": "severity"
+          }
+        }
+      ],
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 12,
+        "x": 6,
+        "y": 13
+      },
+      "id": 19,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "builder",
+          "expr": "bind_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 3,
+        "x": 18,
+        "y": 13
+      },
+      "id": 29,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "nginx_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "WEB Server",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 3,
+        "x": 21,
+        "y": 13
+      },
+      "id": 21,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "influxdb_exporter_stats_query_success",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "InfluxDB",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 4,
+        "x": 6,
+        "y": 16
+      },
+      "id": 20,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(bind_resolver_queries_total{instance=\"binary0ne-1:9119\"}[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "queries/m",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 4,
+        "x": 10,
+        "y": 16
+      },
+      "id": 51,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(bind_resolver_queries_total{instance=\"binary0ne-2:9119\"}[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "queries/m",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 4,
+        "x": 14,
+        "y": 16
+      },
+      "id": 52,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(bind_resolver_queries_total{instance=\"binary0ne-3:9119\"}[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "queries/m",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 3,
+        "x": 18,
+        "y": 16
+      },
+      "id": 22,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum(rate(nginx_http_requests_total[1m])) * 60",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "requests/m",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "short"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 3,
+        "w": 3,
+        "x": 21,
+        "y": 16
+      },
+      "id": 30,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "influxdb_write_write_ok{instance=\"binary0ne-2:9424\"}",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "writes",
+      "type": "stat"
+    },
+    {
+      "collapsed": false,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 19
+      },
+      "id": 15,
+      "panels": [],
+      "title": "CPU/RAM",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 100,
+            "axisSoftMin": 0,
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 22,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 1,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "noValue": "0",
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 11,
+        "w": 12,
+        "x": 0,
+        "y": 20
+      },
+      "id": 49,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "none",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "9.2.6",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum((avg by (instance, mode) (irate(node_cpu_seconds_total{mode!='idle', instance=\"binary0ne-1:9100\"}[30s])) * 100))",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum((avg by (instance, mode) (irate(node_cpu_seconds_total{mode!='idle', instance=\"binary0ne-2:9100\"}[30s])) * 100))",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "B"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "sum((avg by (instance, mode) (irate(node_cpu_seconds_total{mode!='idle', instance=\"binary0ne-3:9100\"}[30s])) * 100))",
+          "hide": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "C"
+        }
+      ],
+      "title": "CPU",
+      "transformations": [],
+      "transparent": true,
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 100,
+            "axisSoftMin": 0,
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 18,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 1,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "noValue": "0",
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 11,
+        "w": 12,
+        "x": 12,
+        "y": 20
+      },
+      "id": 5,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "none",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "(100 * (1 - ((avg_over_time (node_memory_MemFree_bytes{job=\"linux\"}[30s]) + avg_over_time(node_memory_Cached_bytes{job=\"linux\"}[30s]) + avg_over_time(node_memory_Buffers_bytes{job=\"linux\"}[30s])) / avg_over_time(node_memory_MemTotal_bytes{job=\"linux\"}[30s]))))",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "RAM",
+      "transformations": [
+        {
+          "id": "labelsToFields",
+          "options": {
+            "valueLabel": "instance"
+          }
+        }
+      ],
+      "type": "timeseries"
+    }
+  ],
+  "refresh": "5s",
+  "schemaVersion": 37,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-5m",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "MySQL",
+  "uid": "cwPmiRF4zd",
+  "version": 3,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [binary0ne-2] => (item=provisioning/dashboards/mysql.json)
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpkbim4wqf/default.yaml.j2
@@ -0,0 +1,21 @@
+datasources:
+  - name: Prometheus
+    type: prometheus
+    url: http://binary0ne-2/prometheus
+    isDefault: true
+  - name: Telegraf
+    type: influxdb
+    database: telegraf
+    url: http://binary0ne-2:8086
+    jsonData:
+      httpMode: GET
+  - name: influxDB
+    type: influxdb
+    database: latency
+    url: http://binary0ne-2:8086
+    jsonData:
+      httpMode: GET
+
+
+
+

changed: [binary0ne-2] => (item=provisioning/datasources/default.yaml)

TASK [grafana : Create grafana container] **************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [binary0ne-2]

RUNNING HANDLER [grafana : Restart grafana] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "restarted": false,
+    "restarted": true,
     "running": true
 }

changed: [binary0ne-2]

PLAY [Prometheus] **************************************************************

TASK [prometheus : Get variables] **********************************************
ok: [binary0ne-2]

TASK [prometheus : Install prometheus] *****************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc
Suggested packages:
  npm
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc prometheus
0 upgraded, 19 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

TASK [prometheus : Update prometheus config] ***********************************
--- before: /etc/prometheus/prometheus.yml
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpg2lgpkw6/prometheus.yml.j2
@@ -24,7 +24,6 @@
 # A scrape configuration containing exactly one endpoint to scrape:
 # Here it's Prometheus itself.
 scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
   - job_name: 'prometheus'
 
     # Override the global default and scrape targets from this job every 5 seconds.
@@ -35,10 +34,32 @@
     # scheme defaults to 'http'.
 
     static_configs:
-      - targets: ['localhost:9090']
+      - targets: ['localhost:9100']
 
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
+  - job_name: linux
     static_configs:
-      - targets: ['localhost:9100']
+      - targets: ['binary0ne-1:9100', 'binary0ne-2:9100', 'binary0ne-3:9100', ]
+
+  - job_name: db
+    static_configs:
+      - targets: ['binary0ne-1:9104', 'binary0ne-3:9104', ]
+
+  - job_name: dns
+    static_configs:
+      - targets: ['binary0ne-2:9119', 'binary0ne-1:9119', 'binary0ne-3:9119', ]
+
+  - job_name: nginx
+    static_configs:
+      - targets: ['binary0ne-1:9113', 'binary0ne-3:9113', 'binary0ne-2:9113', ]
+
+  - job_name: influxdb
+    static_configs:
+      - targets: ['binary0ne-2:9424', ]
+
+  - job_name: haproxy
+    static_configs:
+      - targets: ['binary0ne-1:9101', 'binary0ne-3:9101', ]
+
+  - job_name: keepalived
+    static_configs:
+      - targets: ['binary0ne-1:9165', 'binary0ne-3:9165', ]
\ No newline at end of file

changed: [binary0ne-2]

TASK [prometheus : Fix prometheus path] ****************************************
--- before: /etc/default/prometheus
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp810rb3mu/prometheus.j2
@@ -1,57 +1 @@
-# Set the command-line arguments to pass to the server.
-ARGS=""
-
-# Prometheus supports the following options:
-#  --config.file="/etc/prometheus/prometheus.yml"
-#                             Prometheus configuration file path.
-#  --web.listen-address="0.0.0.0:9090"
-#                             Address to listen on for UI, API, and telemetry.
-#  --web.read-timeout=5m      Maximum duration before timing out read of the
-#                             request, and closing idle connections.
-#  --web.max-connections=512  Maximum number of simultaneous connections.
-#  --web.external-url=<URL>   The URL under which Prometheus is externally
-#                             reachable (for example, if Prometheus is served
-#                             via a reverse proxy). Used for generating
-#                             relative and absolute links back to Prometheus
-#                             itself. If the URL has a path portion, it will
-#                             be used to prefix all HTTP endpoints served by
-#                             Prometheus. If omitted, relevant URL components
-#                             will be derived automatically.
-#  --web.route-prefix=<path>  Prefix for the internal routes of web endpoints.
-#                             Defaults to path of --web.external-url.
-#  --web.local-assets="/usr/share/prometheus/web/"
-#                             Path to static asset/templates directory.
-#  --web.user-assets=<path>   Path to static asset directory, available at
-#                             /user.
-#  --web.enable-lifecycle     Enable shutdown and reload via HTTP request.
-#  --web.enable-admin-api     Enables API endpoints for admin control actions.
-#  --web.console.templates="/etc/prometheus/consoles"
-#                             Path to the console template directory,
-#                             available at /consoles.
-#  --web.console.libraries="/etc/prometheus/console_libraries"
-#                             Path to the console library directory.
-#  --storage.tsdb.path="/var/lib/prometheus/metrics2/"
-#                             Base path for metrics storage.
-#  --storage.tsdb.min-block-duration=2h
-#                             Minimum duration of a data block before being
-#                             persisted.
-#  --storage.tsdb.max-block-duration=<duration>
-#                             Maximum duration compacted blocks may span.
-#                             (Defaults to 10% of the retention period)
-#  --storage.tsdb.retention=15d
-#                             How long to retain samples in the storage.
-#  --storage.tsdb.use-lockfile
-#                             Create a lockfile in data directory.
-#  --alertmanager.notification-queue-capacity=10000
-#                             The capacity of the queue for pending alert
-#                             manager notifications.
-#  --alertmanager.timeout=10s
-#                             Timeout for sending alerts to Alertmanager.
-#  --query.lookback-delta=5m  The delta difference allowed for retrieving
-#                             metrics during expression evaluations.
-#  --query.timeout=2m         Maximum time a query may take before being
-#                             aborted.
-#  --query.max-concurrency=20
-#                             Maximum number of queries executed concurrently.
-#  --log.level=info           Only log messages with the given severity or
-#                             above. One of: [debug, info, warn, error]
+ARGS="--web.external-url='http://193.40.156.67:14380/prometheus'"

changed: [binary0ne-2]

RUNNING HANDLER [prometheus : Run prometheus] **********************************
ok: [binary0ne-2]

RUNNING HANDLER [prometheus : Restart prometheus] ******************************
changed: [binary0ne-2]

PLAY [Database server] *********************************************************

TASK [mysql : Install MySQL] ***************************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]

TASK [mysql : Upload MySQL config] *********************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpvlmcex3w/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 32
\ No newline at end of file

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp7tch5a25/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 156
\ No newline at end of file

changed: [binary0ne-3]

TASK [mysql : Install dependencies for ansible] ********************************
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]

TASK [mysql : Read only for slaves] ********************************************
changed: [binary0ne-1]
changed: [binary0ne-3]

TASK [mysql : MySQL database] **************************************************
changed: [binary0ne-3]
changed: [binary0ne-1]

TASK [mysql : agama MySQL user] ************************************************
changed: [binary0ne-3]
changed: [binary0ne-1]

TASK [mysql : replication MySQL user] ******************************************
changed: [binary0ne-1]
changed: [binary0ne-3]

TASK [mysql_backup : Ensure backup folder is created] **************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/mysql/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-1]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/mysql/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-3]

TASK [mysql_backup : Create mysql backup user] *********************************
changed: [binary0ne-1]
changed: [binary0ne-3]

TASK [mysql_backup : Upload mysql backup user config] **************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpl67p2wiq/.my.cnf.j2
@@ -0,0 +1,7 @@
+[client]
+user=backup
+password=SUPERPASSWORD
+
+[mysqldump]
+no_tablespaces
+

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp2ivwwf6i/.my.cnf.j2
@@ -0,0 +1,7 @@
+[client]
+user=backup
+password=SUPERPASSWORD
+
+[mysqldump]
+no_tablespaces
+

changed: [binary0ne-3]

TASK [mysql_backup : Upload crontab for agama backup] **************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpigqy4p8m/mysql-backup.j2
@@ -0,0 +1 @@
+

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpl4t0yupw/mysql-backup.j2
@@ -0,0 +1,3 @@
+53,54,55 7,15,23 * * *  backup  mysqldump agama > /home/backup/mysql/agama.sql
+0 0 * * *  backup  duplicity --no-encryption full /home/backup/mysql/ rsync://binary0ne@backup/mysql
+0 8,16 * * *  backup  duplicity --no-encryption incremental /home/backup/mysql/ rsync://binary0ne@backup/mysql

changed: [binary0ne-3]

RUNNING HANDLER [mysql : Run MySQL-server] *************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

RUNNING HANDLER [mysql : Restart MySQL-server] *********************************
changed: [binary0ne-3]
changed: [binary0ne-1]

RUNNING HANDLER [mysql : Reset MySQL source] ***********************************
skipping: [binary0ne-3] => (item=stopreplica) 
skipping: [binary0ne-3] => (item=resetprimary) 
ok: [binary0ne-1] => (item=stopreplica)
changed: [binary0ne-1] => (item=resetprimary)

RUNNING HANDLER [mysql : Reset MySQL replica] **********************************
skipping: [binary0ne-1] => (item=stopreplica) 
skipping: [binary0ne-1] => (item=changeprimary) 
skipping: [binary0ne-1] => (item=resetreplica) 
skipping: [binary0ne-1] => (item=startreplica) 
ok: [binary0ne-3] => (item=stopreplica)
changed: [binary0ne-3] => (item=changeprimary)
changed: [binary0ne-3] => (item=resetreplica)
changed: [binary0ne-3] => (item=startreplica)

PLAY [Web server] **************************************************************

TASK [nginx : Install nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]

TASK [nginx : Upload nginx config] *********************************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpdkr76xwo/default.j2
@@ -1,91 +1,19 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
 	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+        proxy_set_header Host $http_host;
+		proxy_pass http://localhost:8001;
 	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
 }
 
+server {
+	listen 127.0.0.1:8080;
+	server_name _;
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+    location = /stub_status {
+        stub_status;
+    }
+}

changed: [binary0ne-3]
--- before: /etc/nginx/sites-enabled/default
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpz3u034x9/default.j2
@@ -1,91 +1,19 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
 	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+        proxy_set_header Host $http_host;
+		proxy_pass http://localhost:8001;
 	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
 }
 
+server {
+	listen 127.0.0.1:8080;
+	server_name _;
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+    location = /stub_status {
+        stub_status;
+    }
+}

changed: [binary0ne-1]

TASK [docker : Install docker (and save the God all of us!)] *******************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz runc ubuntu-fan
0 upgraded, 8 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz runc ubuntu-fan
0 upgraded, 8 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]

TASK [docker : Install pyhon3-docker] ******************************************
The following additional packages will be installed:
  python3-websocket
The following NEW packages will be installed:
  python3-docker python3-websocket
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following additional packages will be installed:
  python3-websocket
The following NEW packages will be installed:
  python3-docker python3-websocket
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]

TASK [agama : Get agama structure vars] ****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [agama : Create Agama Folder] *********************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-3]

TASK [agama : Get Agama] *******************************************************
changed: [binary0ne-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
changed: [binary0ne-3] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
changed: [binary0ne-3] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/Dockerfile)
changed: [binary0ne-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/Dockerfile)

TASK [agama : Build agama] *****************************************************
changed: [binary0ne-1]
changed: [binary0ne-3]

TASK [agama : Run agama container] *********************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [binary0ne-3] => (item=0)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [binary0ne-1] => (item=0)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [binary0ne-1] => (item=1)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [binary0ne-3] => (item=1)

TASK [keepalived : Install keepalived] *****************************************
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]

TASK [keepalived : Add group] **************************************************
changed: [binary0ne-3]
changed: [binary0ne-1]

TASK [keepalived : Add user for scripts] ***************************************
changed: [binary0ne-3]
changed: [binary0ne-1]

TASK [keepalived : Upload script] **********************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpr6trbu7m/vrrp_script.sh.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpmbv9pa5h/vrrp_script.sh.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '

changed: [binary0ne-3]

TASK [keepalived : Upload keepalived config] ***********************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpkhqn1ulg/keepalived.conf.j2
@@ -0,0 +1,23 @@
+global_defs {
+    enable_script_security
+}
+vrrp_script check_haproxy {
+    script /home/keepalived_script/vrrp_script.sh
+    weight 20
+    interval 1
+}
+vrrp_instance agama {
+    interface ens3
+    virtual_router_id 77
+    priority 52
+    advert_int 1
+    virtual_ipaddress {
+        192.168.100.32/24
+    }
+    unicast_peer {
+        192.168.42.156
+    }
+    track_script {
+        check_haproxy
+    }
+}
\ No newline at end of file

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp1v63q1av/keepalived.conf.j2
@@ -0,0 +1,23 @@
+global_defs {
+    enable_script_security
+}
+vrrp_script check_haproxy {
+    script /home/keepalived_script/vrrp_script.sh
+    weight 20
+    interval 1
+}
+vrrp_instance agama {
+    interface ens3
+    virtual_router_id 77
+    priority 56
+    advert_int 1
+    virtual_ipaddress {
+        192.168.100.32/24
+    }
+    unicast_peer {
+        192.168.42.32
+    }
+    track_script {
+        check_haproxy
+    }
+}
\ No newline at end of file

changed: [binary0ne-3]

TASK [keepalived : Download keepalived-exporter] *******************************
changed: [binary0ne-1]
changed: [binary0ne-3]

TASK [keepalived : Put exporter to bin folder] *********************************
changed: [binary0ne-1]
changed: [binary0ne-3]

TASK [keepalived : Placing keepalived-exporter service] ************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpv7htgy3s/prometheus-keepalived-exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=/usr/local/bin/prometheus-keepalived-exporter
+Documentation=/usr/local/bin/prometheus-keepalived-exporter
+After=network-online.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/prometheus-keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpw24cx2qq/prometheus-keepalived-exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=/usr/local/bin/prometheus-keepalived-exporter
+Documentation=/usr/local/bin/prometheus-keepalived-exporter
+After=network-online.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/prometheus-keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [binary0ne-3]

TASK [haproxy : Load agama vars] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Install HAproxy] ***********************************************
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]

TASK [haproxy : Upload haproxy config] *****************************************
--- before: /etc/haproxy/haproxy.cfg
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp5rhsdtju/haproxy.cfg.j2
@@ -1,34 +1,45 @@
 global
-	log /dev/log	local0
-	log /dev/log	local1 notice
-	chroot /var/lib/haproxy
-	stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
-	stats timeout 30s
-	user haproxy
-	group haproxy
-	daemon
+        log /dev/log    local0
+        log /dev/log    local1 notice
+        chroot /var/lib/haproxy
+        stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
+        stats timeout 30s
+        user haproxy
+        group haproxy
+        daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
+        # Default SSL material locations
+        ca-base /etc/ssl/certs
+        crt-base /etc/ssl/private
 
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
+        # See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
         ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
         ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
         ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
-	log	global
-	mode	http
-	option	httplog
-	option	dontlognull
+        log     global
+        mode    http
+        option  httplog
+        option  dontlognull
         timeout connect 5000
         timeout client  50000
         timeout server  50000
-	errorfile 400 /etc/haproxy/errors/400.http
-	errorfile 403 /etc/haproxy/errors/403.http
-	errorfile 408 /etc/haproxy/errors/408.http
-	errorfile 500 /etc/haproxy/errors/500.http
-	errorfile 502 /etc/haproxy/errors/502.http
-	errorfile 503 /etc/haproxy/errors/503.http
-	errorfile 504 /etc/haproxy/errors/504.http
+        errorfile 400 /etc/haproxy/errors/400.http
+        errorfile 403 /etc/haproxy/errors/403.http
+        errorfile 408 /etc/haproxy/errors/408.http
+        errorfile 500 /etc/haproxy/errors/500.http
+        errorfile 502 /etc/haproxy/errors/502.http
+        errorfile 503 /etc/haproxy/errors/503.http
+        errorfile 504 /etc/haproxy/errors/504.http
+listen my_ha_frontend
+    bind :88
+    server docker0 binary0ne-1:8001 check
+    server docker1 binary0ne-1:8002 check
+    server docker2 binary0ne-3:8001 check
+    server docker3 binary0ne-3:8002 check
+listen stats
+    bind *:8404
+    stats enable
+    stats uri /monitor
+    stats refresh 5s

changed: [binary0ne-1]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpk38sadiu/haproxy.cfg.j2
@@ -1,34 +1,45 @@
 global
-	log /dev/log	local0
-	log /dev/log	local1 notice
-	chroot /var/lib/haproxy
-	stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
-	stats timeout 30s
-	user haproxy
-	group haproxy
-	daemon
+        log /dev/log    local0
+        log /dev/log    local1 notice
+        chroot /var/lib/haproxy
+        stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
+        stats timeout 30s
+        user haproxy
+        group haproxy
+        daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
+        # Default SSL material locations
+        ca-base /etc/ssl/certs
+        crt-base /etc/ssl/private
 
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
+        # See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
         ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
         ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
         ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
-	log	global
-	mode	http
-	option	httplog
-	option	dontlognull
+        log     global
+        mode    http
+        option  httplog
+        option  dontlognull
         timeout connect 5000
         timeout client  50000
         timeout server  50000
-	errorfile 400 /etc/haproxy/errors/400.http
-	errorfile 403 /etc/haproxy/errors/403.http
-	errorfile 408 /etc/haproxy/errors/408.http
-	errorfile 500 /etc/haproxy/errors/500.http
-	errorfile 502 /etc/haproxy/errors/502.http
-	errorfile 503 /etc/haproxy/errors/503.http
-	errorfile 504 /etc/haproxy/errors/504.http
+        errorfile 400 /etc/haproxy/errors/400.http
+        errorfile 403 /etc/haproxy/errors/403.http
+        errorfile 408 /etc/haproxy/errors/408.http
+        errorfile 500 /etc/haproxy/errors/500.http
+        errorfile 502 /etc/haproxy/errors/502.http
+        errorfile 503 /etc/haproxy/errors/503.http
+        errorfile 504 /etc/haproxy/errors/504.http
+listen my_ha_frontend
+    bind :88
+    server docker0 binary0ne-1:8001 check
+    server docker1 binary0ne-1:8002 check
+    server docker2 binary0ne-3:8001 check
+    server docker3 binary0ne-3:8002 check
+listen stats
+    bind *:8404
+    stats enable
+    stats uri /monitor
+    stats refresh 5s

changed: [binary0ne-3]

TASK [haproxy : Install haproxy exporter] **************************************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]

TASK [haproxy : Provide haproxy config] ****************************************
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmprsf7clys/prometheus-haproxy-exporter.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri="http://localhost:8404/monitor;csv""

changed: [binary0ne-1]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp721hc3ve/prometheus-haproxy-exporter.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri="http://localhost:8404/monitor;csv""

changed: [binary0ne-3]

RUNNING HANDLER [nginx : Run Nginx] ********************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [binary0ne-1]
changed: [binary0ne-3]

RUNNING HANDLER [keepalived : Run keepalived] **********************************
changed: [binary0ne-1]
changed: [binary0ne-3]

RUNNING HANDLER [keepalived : Restart keepalived] ******************************
changed: [binary0ne-1]
changed: [binary0ne-3]

RUNNING HANDLER [keepalived : Reload systemctl] ********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

RUNNING HANDLER [keepalived : Run keepalived exporter] *************************
changed: [binary0ne-1]
changed: [binary0ne-3]

RUNNING HANDLER [haproxy : Run haproxy] ****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

RUNNING HANDLER [haproxy : Restart haproxy] ************************************
changed: [binary0ne-1]
changed: [binary0ne-3]

RUNNING HANDLER [haproxy : Run haproxy exporter] *******************************
ok: [binary0ne-3]
ok: [binary0ne-1]

RUNNING HANDLER [haproxy : Restart haproxy exporter] ***************************
changed: [binary0ne-1]
changed: [binary0ne-3]

PLAY [DB monitoring] ***********************************************************

TASK [mysql_exporter : Install mysql exporter] *********************************
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]

TASK [mysql_exporter : Add slave status exporter] ******************************
--- before: /etc/default/prometheus-mysqld-exporter
+++ after: /Users/antonvisnevski/Desktop/code/ica0002/roles/mysql_exporter/files/prometheus-mysqld-exporter
@@ -1,120 +1,2 @@
-# By default the connection string will be read from
-# $HOME/my.cnf or from the file specified with the -config.my-cnf parameter.
+ARGS="--collect.slave_status"
 
-# To set a connection string from the environment instead, uncomment one of the
-# following lines.
-
-# Using UNIX domain sockets and authentication:
-# DATA_SOURCE_NAME="prometheus:nopassword@unix(/run/mysqld/mysqld.sock)/"
-
-# Using a TCP connection and password authentication:
-# DATA_SOURCE_NAME="login:password@(hostname:port)/dbname"
-
-# Note the user must be granted enough privileges for the exporter to run.
-# Example to create a user to connect with the UNIX socket:
-#
-#  CREATE USER IF NOT EXISTS 'prometheus'@'localhost' IDENTIFIED VIA unix_socket;
-#  GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'prometheus'@'localhost';
-
-# Set the command-line arguments to pass to the exporter.
-# ARGS='-config.my-cnf /etc/mysql/debian.cnf'
-
-# Usage of prometheus-mysqld-exporter:
-#   -collect.auto_increment.columns
-#     	Collect auto_increment columns and max values from information_schema
-#  --exporter.lock_wait_timeout=2
-#       Set a lock_wait_timeout on the connection to avoid long metadata
-#       locking.
-#  --exporter.log_slow_filter
-#       Add a log_slow_filter to avoid slow query logging of scrapes. NOTE: Not
-#       supported by Oracle MySQL.
-#  --collect.heartbeat.database="heartbeat"
-#       Database from where to collect heartbeat data
-#  --collect.heartbeat.table="heartbeat"
-#       Table from where to collect heartbeat data
-#  --collect.info_schema.processlist.min_time=0
-#       Minimum time a thread must be in each state to be counted
-#  --collect.info_schema.tables.databases="*"
-#       The list of databases to collect table stats for, or '*' for all
-#  --collect.perf_schema.eventsstatements.limit=250
-#       Limit the number of events statements digests by response time
-#  --collect.perf_schema.eventsstatements.timelimit=86400
-#       Limit how old the 'last_seen' events statements can be, in seconds
-#  --collect.perf_schema.eventsstatements.digest_text_limit=120
-#       Maximum length of the normalized statement text
-#  --collect.perf_schema.file_instances.filter=".*"
-#       RegEx file_name filter for performance_schema.file_summary_by_instance
-#  --collect.perf_schema.file_instances.remove_prefix="/var/lib/mysql/"
-#       Remove path prefix in performance_schema.file_summary_by_instance
-#  --web.listen-address=":9104"
-#       Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#       Path under which to expose metrics.
-#  --config.my-cnf="$HOME/.my.cnf"
-#       Path to .my.cnf file to read MySQL credentials from.
-#  --collect.global_variables
-#       Collect from SHOW GLOBAL VARIABLES
-#  --collect.slave_status
-#       Collect from SHOW SLAVE STATUS
-#  --collect.info_schema.processlist
-#       Collect current thread state counts from the
-#       information_schema.processlist
-#  --collect.info_schema.tables
-#       Collect metrics from information_schema.tables
-#  --collect.info_schema.innodb_tablespaces
-#       Collect metrics from information_schema.innodb_sys_tablespaces
-#  --collect.info_schema.innodb_metrics
-#       Collect metrics from information_schema.innodb_metrics
-#  --collect.auto_increment.columns
-#       Collect auto_increment columns and max values from information_schema
-#  --collect.global_status
-#       Collect from SHOW GLOBAL STATUS
-#  --collect.perf_schema.tableiowaits
-#       Collect metrics from performance_schema.table_io_waits_summary_by_table
-#  --collect.perf_schema.indexiowaits
-#       Collect metrics from
-#       performance_schema.table_io_waits_summary_by_index_usage
-#  --collect.perf_schema.tablelocks
-#       Collect metrics from
-#       performance_schema.table_lock_waits_summary_by_table
-#  --collect.perf_schema.eventsstatements
-#       Collect metrics from
-#       performance_schema.events_statements_summary_by_digest
-#  --collect.perf_schema.eventswaits
-#       Collect metrics from
-#       performance_schema.events_waits_summary_global_by_event_name
-#  --collect.perf_schema.file_events
-#       Collect metrics from performance_schema.file_summary_by_event_name
-#  --collect.perf_schema.file_instances
-#       Collect metrics from performance_schema.file_summary_by_instance
-#  --collect.binlog_size
-#       Collect the current size of all registered binlog files
-#  --collect.info_schema.userstats
-#       If running with userstat=1, set to true to collect user statistics
-#  --collect.info_schema.clientstats
-#       If running with userstat=1, set to true to collect client statistics
-#  --collect.info_schema.tablestats
-#       If running with userstat=1, set to true to collect table statistics
-#  --collect.info_schema.innodb_cmp
-#       Collect metrics from information_schema.innodb_cmp
-#  --collect.info_schema.innodb_cmpmem
-#       Collect metrics from information_schema.innodb_cmpmem
-#  --collect.info_schema.query_response_time
-#       Collect query response time distribution if query_response_time_stats
-#       is ON.
-#  --collect.engine_tokudb_status
-#       Collect from SHOW ENGINE TOKUDB STATUS
-#  --collect.perf_schema.replication_group_member_stats
-#       Collect metrics from performance_schema.replication_group_member_stats
-#  --collect.heartbeat
-#       Collect from heartbeat
-#  --collect.slave_hosts
-#       Scrape information from 'SHOW SLAVE HOSTS'
-#  --collect.engine_innodb_status
-#       Collect from SHOW ENGINE INNODB STATUS
-#  --log.level="info"
-#       Only log messages with the given severity or above. Valid levels:
-#       [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#       Set the log target and format. Example:
-#       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"

changed: [binary0ne-3]
--- before: /etc/default/prometheus-mysqld-exporter
+++ after: /Users/antonvisnevski/Desktop/code/ica0002/roles/mysql_exporter/files/prometheus-mysqld-exporter
@@ -1,120 +1,2 @@
-# By default the connection string will be read from
-# $HOME/my.cnf or from the file specified with the -config.my-cnf parameter.
+ARGS="--collect.slave_status"
 
-# To set a connection string from the environment instead, uncomment one of the
-# following lines.
-
-# Using UNIX domain sockets and authentication:
-# DATA_SOURCE_NAME="prometheus:nopassword@unix(/run/mysqld/mysqld.sock)/"
-
-# Using a TCP connection and password authentication:
-# DATA_SOURCE_NAME="login:password@(hostname:port)/dbname"
-
-# Note the user must be granted enough privileges for the exporter to run.
-# Example to create a user to connect with the UNIX socket:
-#
-#  CREATE USER IF NOT EXISTS 'prometheus'@'localhost' IDENTIFIED VIA unix_socket;
-#  GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'prometheus'@'localhost';
-
-# Set the command-line arguments to pass to the exporter.
-# ARGS='-config.my-cnf /etc/mysql/debian.cnf'
-
-# Usage of prometheus-mysqld-exporter:
-#   -collect.auto_increment.columns
-#     	Collect auto_increment columns and max values from information_schema
-#  --exporter.lock_wait_timeout=2
-#       Set a lock_wait_timeout on the connection to avoid long metadata
-#       locking.
-#  --exporter.log_slow_filter
-#       Add a log_slow_filter to avoid slow query logging of scrapes. NOTE: Not
-#       supported by Oracle MySQL.
-#  --collect.heartbeat.database="heartbeat"
-#       Database from where to collect heartbeat data
-#  --collect.heartbeat.table="heartbeat"
-#       Table from where to collect heartbeat data
-#  --collect.info_schema.processlist.min_time=0
-#       Minimum time a thread must be in each state to be counted
-#  --collect.info_schema.tables.databases="*"
-#       The list of databases to collect table stats for, or '*' for all
-#  --collect.perf_schema.eventsstatements.limit=250
-#       Limit the number of events statements digests by response time
-#  --collect.perf_schema.eventsstatements.timelimit=86400
-#       Limit how old the 'last_seen' events statements can be, in seconds
-#  --collect.perf_schema.eventsstatements.digest_text_limit=120
-#       Maximum length of the normalized statement text
-#  --collect.perf_schema.file_instances.filter=".*"
-#       RegEx file_name filter for performance_schema.file_summary_by_instance
-#  --collect.perf_schema.file_instances.remove_prefix="/var/lib/mysql/"
-#       Remove path prefix in performance_schema.file_summary_by_instance
-#  --web.listen-address=":9104"
-#       Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#       Path under which to expose metrics.
-#  --config.my-cnf="$HOME/.my.cnf"
-#       Path to .my.cnf file to read MySQL credentials from.
-#  --collect.global_variables
-#       Collect from SHOW GLOBAL VARIABLES
-#  --collect.slave_status
-#       Collect from SHOW SLAVE STATUS
-#  --collect.info_schema.processlist
-#       Collect current thread state counts from the
-#       information_schema.processlist
-#  --collect.info_schema.tables
-#       Collect metrics from information_schema.tables
-#  --collect.info_schema.innodb_tablespaces
-#       Collect metrics from information_schema.innodb_sys_tablespaces
-#  --collect.info_schema.innodb_metrics
-#       Collect metrics from information_schema.innodb_metrics
-#  --collect.auto_increment.columns
-#       Collect auto_increment columns and max values from information_schema
-#  --collect.global_status
-#       Collect from SHOW GLOBAL STATUS
-#  --collect.perf_schema.tableiowaits
-#       Collect metrics from performance_schema.table_io_waits_summary_by_table
-#  --collect.perf_schema.indexiowaits
-#       Collect metrics from
-#       performance_schema.table_io_waits_summary_by_index_usage
-#  --collect.perf_schema.tablelocks
-#       Collect metrics from
-#       performance_schema.table_lock_waits_summary_by_table
-#  --collect.perf_schema.eventsstatements
-#       Collect metrics from
-#       performance_schema.events_statements_summary_by_digest
-#  --collect.perf_schema.eventswaits
-#       Collect metrics from
-#       performance_schema.events_waits_summary_global_by_event_name
-#  --collect.perf_schema.file_events
-#       Collect metrics from performance_schema.file_summary_by_event_name
-#  --collect.perf_schema.file_instances
-#       Collect metrics from performance_schema.file_summary_by_instance
-#  --collect.binlog_size
-#       Collect the current size of all registered binlog files
-#  --collect.info_schema.userstats
-#       If running with userstat=1, set to true to collect user statistics
-#  --collect.info_schema.clientstats
-#       If running with userstat=1, set to true to collect client statistics
-#  --collect.info_schema.tablestats
-#       If running with userstat=1, set to true to collect table statistics
-#  --collect.info_schema.innodb_cmp
-#       Collect metrics from information_schema.innodb_cmp
-#  --collect.info_schema.innodb_cmpmem
-#       Collect metrics from information_schema.innodb_cmpmem
-#  --collect.info_schema.query_response_time
-#       Collect query response time distribution if query_response_time_stats
-#       is ON.
-#  --collect.engine_tokudb_status
-#       Collect from SHOW ENGINE TOKUDB STATUS
-#  --collect.perf_schema.replication_group_member_stats
-#       Collect metrics from performance_schema.replication_group_member_stats
-#  --collect.heartbeat
-#       Collect from heartbeat
-#  --collect.slave_hosts
-#       Scrape information from 'SHOW SLAVE HOSTS'
-#  --collect.engine_innodb_status
-#       Collect from SHOW ENGINE INNODB STATUS
-#  --log.level="info"
-#       Only log messages with the given severity or above. Valid levels:
-#       [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#       Set the log target and format. Example:
-#       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"

changed: [binary0ne-1]

TASK [mysql_exporter : Create mysql monitoring user] ***************************
changed: [binary0ne-3]
changed: [binary0ne-1]

TASK [mysql_exporter : Upload mysql exporter config] ***************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp4t9kz53f/.my.cnf.j2
@@ -0,0 +1,3 @@
+[client]
+user=mysqlexpuser
+password=SUPERPASSWORD

changed: [binary0ne-1]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp90m1n0wb/.my.cnf.j2
@@ -0,0 +1,3 @@
+[client]
+user=mysqlexpuser
+password=SUPERPASSWORD

changed: [binary0ne-3]

TASK [mysql_exporter : Wait for mysql] *****************************************
Pausing for 20 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [binary0ne-1]

TASK [mysql_exporter : Start mysql exporter] ***********************************
changed: [binary0ne-3]
changed: [binary0ne-1]

RUNNING HANDLER [mysql_exporter : Run mysql exporter] **************************
ok: [binary0ne-3]
ok: [binary0ne-1]

RUNNING HANDLER [mysql_exporter : Restart mysql exporter] **********************
changed: [binary0ne-3]
changed: [binary0ne-1]

PLAY [DNS monitoring] **********************************************************

TASK [bind_exporter : Install bind exporter] ***********************************
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

RUNNING HANDLER [bind_exporter : Run bind exporter] ****************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [Nginx monitoring] ********************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [nginx : Upload nginx config] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [nginx_exporter : Install nginx exporter] *********************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-3]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-1]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [binary0ne-3]
changed: [binary0ne-1]
changed: [binary0ne-2]

RUNNING HANDLER [nginx_exporter : Run nginx exporter] **************************
ok: [binary0ne-3]
ok: [binary0ne-1]
ok: [binary0ne-2]

PLAY [InfluxDB] ****************************************************************

TASK [influxdb : Install influxdb] *********************************************
Selecting previously unselected package influxdb.
(Reading database ... 66355 files and directories currently installed.)
Preparing to unpack .../influxdb_1.8.10_amd643xxuzdhw.deb ...
Unpacking influxdb (1.8.10-1) ...
Setting up influxdb (1.8.10-1) ...
Processing triggers for man-db (2.9.1-1) ...
changed: [binary0ne-2]

TASK [influxdb : Start influxdb] ***********************************************
changed: [binary0ne-2]

TASK [influxdb : Upload influxdb config] ***************************************
--- before: /etc/influxdb/influxdb.conf
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpyctsjb3d/influxdb.conf.j2
@@ -12,7 +12,7 @@
 # reporting-disabled = false
 
 # Bind address to use for the RPC service for backup and restore.
-# bind-address = "127.0.0.1:8088"
+bind-address = "0.0.0.0:8088"
 
 ###
 ### [meta]
@@ -43,7 +43,7 @@
 [data]
   # The directory where the TSM storage engine stores TSM files.
   dir = "/var/lib/influxdb/data"
-
+  query-log-enabled = false
   # The directory where the TSM storage engine stores WAL files.
   wal-dir = "/var/lib/influxdb/wal"
 
@@ -142,12 +142,12 @@
   # Values without a size suffix are in bytes.
   # max-index-log-file-size = "1m"
 
-  # The size of the internal cache used in the TSI index to store previously 
+  # The size of the internal cache used in the TSI index to store previously
   # calculated series results. Cached results will be returned quickly from the cache rather
-  # than needing to be recalculated when a subsequent query with a matching tag key/value 
+  # than needing to be recalculated when a subsequent query with a matching tag key/value
   # predicate is executed. Setting this value to 0 will disable the cache, which may
   # lead to query performance issues.
-  # This value should only be increased if it is known that the set of regularly used 
+  # This value should only be increased if it is known that the set of regularly used
   # tag key/value predicates across all measurements for a database is larger than 100. An
   # increase in cache size may lead to an increase in heap usage.
   series-id-set-cache-size = 100
@@ -248,8 +248,9 @@
 
 [http]
   # Determines whether HTTP endpoint is enabled.
-  # enabled = true
-
+  enabled = true
+  log-enabled = false
+  write-tracing = false
   # Determines whether the Flux query endpoint is enabled.
   # flux-enabled = false
 
@@ -257,10 +258,10 @@
   # flux-log-enabled = false
 
   # The bind address used by the HTTP service.
-  # bind-address = ":8086"
+  bind-address = ":8086"
 
   # Determines whether user authentication is enabled over HTTP/HTTPS.
-  # auth-enabled = false
+  auth-enabled = false
 
   # The default realm sent back when issuing a basic auth challenge.
   # realm = "InfluxDB"
@@ -345,11 +346,11 @@
   # Setting this to 0 or setting max-concurrent-write-limit to 0 disables the limit.
   # enqueued-write-timeout = 0
 
-	# User supplied HTTP response headers
-	#
-	# [http.headers]
-	#   X-Header-1 = "Header Value 1"
-	#   X-Header-2 = "Header Value 2"
+        # User supplied HTTP response headers
+        #
+        # [http.headers]
+        #   X-Header-1 = "Header Value 1"
+        #   X-Header-2 = "Header Value 2"
 
 ###
 ### [logging]

changed: [binary0ne-2]

TASK [influxdb_backup : Ensure backup folder is created] ***********************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/influxdb/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-2]

TASK [influxdb_backup : Upload crontab for influxdb backup] ********************
--- before
+++ after: /Users/antonvisnevski/Desktop/code/ica0002/roles/influxdb_backup/files/influxdb-backup
@@ -0,0 +1,3 @@
+55 7,15,23 * * *  backup  rm -rf /home/backup/influxdb/*; influxd backup -portable -database telegraf /home/backup/influxdb
+0 0 * * *  backup  duplicity --no-encryption full /home/backup/influxdb/ rsync://binary0ne@backup/influxdb
+0 8,16 * * *  backup  duplicity --no-encryption incremental /home/backup/influxdb/ rsync://binary0ne@backup/influxdb

changed: [binary0ne-2]

RUNNING HANDLER [influxdb : Run influxdb] **************************************
ok: [binary0ne-2]

RUNNING HANDLER [influxdb : Restart influxdb] **********************************
changed: [binary0ne-2]

PLAY [Influxdb-exporter] *******************************************************

TASK [influxdb_exporter : download influxdb exporter] **************************
changed: [binary0ne-2]

TASK [influxdb_exporter : set mode for influx exporter] ************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "mode": "0644",
-    "owner": 0,
+    "group": 119,
+    "mode": "0550",
+    "owner": 112,
     "path": "/usr/local/bin/prometheus-influxdb-exporter"
 }

changed: [binary0ne-2]

TASK [influxdb_exporter : upload service template for influxdb exporter] *******
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpo7256a46/prometheus-influxdb-exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=/usr/local/bin/prometheus-influxdb-exporter
+Documentation=/usr/local/bin/prometheus-influxdb-exporter
+After=network-online.target
+
+[Service]
+User=prometheus
+ExecStart=/usr/local/bin/prometheus-influxdb-exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [binary0ne-2]

RUNNING HANDLER [influxdb_exporter : Reload systemctl] *************************
ok: [binary0ne-2]

RUNNING HANDLER [influxdb_exporter : Run influxdb exporter] ********************
changed: [binary0ne-2]

PLAY [pinger] ******************************************************************

TASK [pinger : Ensure group pinger exists] *************************************
changed: [binary0ne-2]

TASK [pinger : Add pinger user] ************************************************
changed: [binary0ne-2]

TASK [pinger : Install dependency] *********************************************
The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

TASK [pinger : Placing pinger script] ******************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp5k9yebb2/pinger.sh.j2
@@ -0,0 +1,25 @@
+#!/bin/bash
+# Script contains several (more than 1) security issues.
+# Find them and fix them to get bonus on exam.
+# Problem example: SQL injection.
+
+for t in database_url database_name targets; do
+  if ! grep -q "^${t}=" /etc/pinger/pinger.conf; then
+    logger "$0 Failed to get $t from config"
+    exit 1
+  fi
+done
+
+which fping > /dev/null || (logger "fping not found"; exit 1)
+
+db_url=$(grep "^database_url=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+db_name=$(grep "^database_name=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+targets=$(grep "^targets=" /etc/pinger/pinger.conf | sed 's/^.*=//' | sed 's/\(,\|;\)/ /g')
+
+curl -i -XPOST "${db_url}/query" --data-urlencode "q=CREATE DATABASE $db_name" 1>/dev/null 2>/dev/null
+
+while true; do
+  result=$(fping -C1 -q $targets 2>&1 | awk '{print "rtt,dst="$1" rtt="$3}')
+  curl -i -XPOST "${db_url}/write?db=$db_name" --data-binary "$result" 1>/dev/null 2>/dev/null
+ sleep 1
+done
\ No newline at end of file

changed: [binary0ne-2]

TASK [pinger : Placing pinger service] *****************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp2iun_dd2/pinger.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=/usr/local/bin/pinger
+Documentation=/usr/local/bin/pinger
+After=network-online.target
+
+[Service]
+User=pinger
+ExecStart=/usr/local/bin/pinger
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [binary0ne-2]

TASK [pinger : Create pinger config folder] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/pinger/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [binary0ne-2]

TASK [pinger : Upload pinger config] *******************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmptukcb00i/pinger.conf.j2
@@ -0,0 +1,3 @@
+database_url=http://binary0ne-2:8086
+database_name=latency
+targets=google.com,cloudflare.com,twitter.com
\ No newline at end of file

changed: [binary0ne-2]

RUNNING HANDLER [pinger : Reload systemctl] ************************************
ok: [binary0ne-2]

RUNNING HANDLER [pinger : Run pinger] ******************************************
changed: [binary0ne-2]

RUNNING HANDLER [pinger : Restart pinger] **************************************
changed: [binary0ne-2]

PLAY [telegraf] ****************************************************************

TASK [telegraf : Add telegraf key] *********************************************
changed: [binary0ne-2]

TASK [telegraf : add telegraf repo] ********************************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/repos_influxdata_com_debian.list
@@ -0,0 +1 @@
+deb https://repos.influxdata.com/debian stable main

changed: [binary0ne-2]

TASK [telegraf : Install telegraf] *********************************************
The following NEW packages will be installed:
  telegraf
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [binary0ne-2]

TASK [telegraf : Upload telegraf config] ***************************************
diff skipped: destination file size is greater than 104448
changed: [binary0ne-2]

RUNNING HANDLER [telegraf : Run telegraf] **************************************
ok: [binary0ne-2]

RUNNING HANDLER [telegraf : Restart telegraf] **********************************
changed: [binary0ne-2]

PLAY [rsyslog logging] *********************************************************

TASK [rsyslog : Setup rsyslog] *************************************************
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpbwk0ueh4/50-telegraf.conf.j2
@@ -0,0 +1,4 @@
+# forward over tcp with octet framing according to RFC 5425
+action(type="omfwd" Protocol="udp" Target="binary0ne-2" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+# uncomment to use udp according to RFC 5424
+#action(type="omfwd" Protocol="udp" Target="127.0.0.1" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")

changed: [binary0ne-2]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmp4jy4livy/50-telegraf.conf.j2
@@ -0,0 +1,4 @@
+# forward over tcp with octet framing according to RFC 5425
+action(type="omfwd" Protocol="udp" Target="binary0ne-2" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+# uncomment to use udp according to RFC 5424
+#action(type="omfwd" Protocol="udp" Target="127.0.0.1" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")

changed: [binary0ne-3]
--- before
+++ after: /Users/antonvisnevski/.ansible/tmp/ansible-local-33045f_d15ab4/tmpkgs5itxw/50-telegraf.conf.j2
@@ -0,0 +1,4 @@
+# forward over tcp with octet framing according to RFC 5425
+action(type="omfwd" Protocol="udp" Target="binary0ne-2" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+# uncomment to use udp according to RFC 5424
+#action(type="omfwd" Protocol="udp" Target="127.0.0.1" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")

changed: [binary0ne-1]

RUNNING HANDLER [rsyslog : Restart rsyslog] ************************************
changed: [binary0ne-2]
changed: [binary0ne-1]
changed: [binary0ne-3]

PLAY RECAP *********************************************************************
binary0ne-1                : ok=84   changed=67   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
binary0ne-2                : ok=85   changed=63   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
binary0ne-3                : ok=83   changed=67   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ ansible-playbook infra.yaml --diff

PLAY [Operations on local machine] *********************************************

PLAY [Swap db master and slave] ************************************************

PLAY [Gather facts] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]
ok: [binary0ne-2]

PLAY [Remote hosts setup] ******************************************************

TASK [remote_hosts : Update and upgrade apt packages] **************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [remote_hosts : Update CA certificates] ***********************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [node_exporter : Installing Prometheus node exporter] *********************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Add backup group] ***********************************************
ok: [binary0ne-3]
ok: [binary0ne-1]
ok: [binary0ne-2]

TASK [backup : Add backup user] ************************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [backup : Ensure .ssh exists] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Generate keypair] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Change ownership] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [backup : Add SSH keys for users] *****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Add to known hosts] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Ensure restore folder is created] *******************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [backup : Install duplicity] **********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [DNS server] **************************************************************

TASK [bind : Install bind] *****************************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [bind : Install python dependencies] **************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [bind : Update bind config] ***********************************************
ok: [binary0ne-2]
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [bind : Creates zone directory] *******************************************
ok: [binary0ne-2]
ok: [binary0ne-1]
ok: [binary0ne-3]

PLAY [Provide initial dns config] **********************************************

TASK [nsstaticconf : Update zones config] **************************************
ok: [binary0ne-2]

TASK [nsstaticconf : Update reverse config] ************************************
ok: [binary0ne-2]

PLAY [Update ns records] *******************************************************

TASK [nsstaticconf : Update zones config] **************************************
ok: [binary0ne-2]

TASK [nsstaticconf : Update reverse config] ************************************
ok: [binary0ne-2]

TASK [nsupdate : Prepare vars] *************************************************
ok: [binary0ne-2 -> localhost]

TASK [nsupdate : Add new hosts] ************************************************
ok: [binary0ne-2]

TASK [nsupdate : Install python dependencies] **********************************
ok: [binary0ne-2]

TASK [nsupdate : Add dns records] **********************************************
ok: [binary0ne-2] => (item={'name': 'backup', 'address': '192.168.42.132', 'type': 'A'})
ok: [binary0ne-2] => (item={'name': 'grafana', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'influxdb', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'lb1', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'lb2', 'address': 'binary0ne-3', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'mysql1', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'mysql2', 'address': 'binary0ne-3', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'ns1', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'ns2', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'ns3', 'address': 'binary0ne-3', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'prometheus', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'web1', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'web2', 'address': 'binary0ne-3', 'type': 'CNAME'})

PLAY [Update for dns server] ***************************************************

TASK [remote_network : Updating DNS server path] *******************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

PLAY [Nginx for monitoring] ****************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [binary0ne-2]

TASK [nginx : Upload nginx config] *********************************************
ok: [binary0ne-2]

PLAY [Grafana] *****************************************************************

TASK [docker : Install docker (and save the God all of us!)] *******************
ok: [binary0ne-2]

TASK [docker : Install pyhon3-docker] ******************************************
ok: [binary0ne-2]

TASK [grafana : Get grafana structure vars] ************************************
ok: [binary0ne-2]

TASK [grafana : Get public ips] ************************************************
ok: [binary0ne-2]

TASK [grafana : Create grafana directories] ************************************
ok: [binary0ne-2] => (item=provisioning/dashboards)
ok: [binary0ne-2] => (item=provisioning/datasources)

TASK [grafana : Create grafana files] ******************************************
ok: [binary0ne-2] => (item=grafana.ini)
ok: [binary0ne-2] => (item=provisioning/dashboards/provisioning.yaml)
ok: [binary0ne-2] => (item=provisioning/dashboards/main.json)
ok: [binary0ne-2] => (item=provisioning/dashboards/mysql.json)
ok: [binary0ne-2] => (item=provisioning/datasources/default.yaml)

TASK [grafana : Create grafana container] **************************************
ok: [binary0ne-2]

PLAY [Prometheus] **************************************************************

TASK [prometheus : Get variables] **********************************************
ok: [binary0ne-2]

TASK [prometheus : Install prometheus] *****************************************
ok: [binary0ne-2]

TASK [prometheus : Update prometheus config] ***********************************
ok: [binary0ne-2]

TASK [prometheus : Fix prometheus path] ****************************************
ok: [binary0ne-2]

PLAY [Database server] *********************************************************

TASK [mysql : Install MySQL] ***************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [mysql : Upload MySQL config] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql : Install dependencies for ansible] ********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql : Read only for slaves] ********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql : MySQL database] **************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [mysql : agama MySQL user] ************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [mysql : replication MySQL user] ******************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [mysql_backup : Ensure backup folder is created] **************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_backup : Create mysql backup user] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_backup : Upload mysql backup user config] **************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_backup : Upload crontab for agama backup] **************************
ok: [binary0ne-1]
ok: [binary0ne-3]

PLAY [Web server] **************************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [nginx : Upload nginx config] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [docker : Install docker (and save the God all of us!)] *******************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [docker : Install pyhon3-docker] ******************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [agama : Get agama structure vars] ****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [agama : Create Agama Folder] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [agama : Get Agama] *******************************************************
ok: [binary0ne-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [binary0ne-3] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [binary0ne-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/Dockerfile)
ok: [binary0ne-3] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/Dockerfile)

TASK [agama : Build agama] *****************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [agama : Run agama container] *********************************************
ok: [binary0ne-1] => (item=0)
ok: [binary0ne-3] => (item=0)
ok: [binary0ne-1] => (item=1)
ok: [binary0ne-3] => (item=1)

TASK [keepalived : Install keepalived] *****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Add group] **************************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Add user for scripts] ***************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Upload script] **********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Upload keepalived config] ***********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Download keepalived-exporter] *******************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Put exporter to bin folder] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Placing keepalived-exporter service] ************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Load agama vars] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Install HAproxy] ***********************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [haproxy : Upload haproxy config] *****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Install haproxy exporter] **************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Provide haproxy config] ****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

PLAY [DB monitoring] ***********************************************************

TASK [mysql_exporter : Install mysql exporter] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Add slave status exporter] ******************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Create mysql monitoring user] ***************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Upload mysql exporter config] ***************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Wait for mysql] *****************************************
Pausing for 20 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [binary0ne-1]

TASK [mysql_exporter : Start mysql exporter] ***********************************
ok: [binary0ne-3]
ok: [binary0ne-1]

PLAY [DNS monitoring] **********************************************************

TASK [bind_exporter : Install bind exporter] ***********************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [Nginx monitoring] ********************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [binary0ne-3]
ok: [binary0ne-2]
ok: [binary0ne-1]

TASK [nginx : Upload nginx config] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [nginx_exporter : Install nginx exporter] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [InfluxDB] ****************************************************************

TASK [influxdb : Install influxdb] *********************************************
ok: [binary0ne-2]

TASK [influxdb : Start influxdb] ***********************************************
ok: [binary0ne-2]

TASK [influxdb : Upload influxdb config] ***************************************
ok: [binary0ne-2]

TASK [influxdb_backup : Ensure backup folder is created] ***********************
ok: [binary0ne-2]

TASK [influxdb_backup : Upload crontab for influxdb backup] ********************
ok: [binary0ne-2]

PLAY [Influxdb-exporter] *******************************************************

TASK [influxdb_exporter : download influxdb exporter] **************************
ok: [binary0ne-2]

TASK [influxdb_exporter : set mode for influx exporter] ************************
ok: [binary0ne-2]

TASK [influxdb_exporter : upload service template for influxdb exporter] *******
ok: [binary0ne-2]

PLAY [pinger] ******************************************************************

TASK [pinger : Ensure group pinger exists] *************************************
ok: [binary0ne-2]

TASK [pinger : Add pinger user] ************************************************
ok: [binary0ne-2]

TASK [pinger : Install dependency] *********************************************
ok: [binary0ne-2]

TASK [pinger : Placing pinger script] ******************************************
ok: [binary0ne-2]

TASK [pinger : Placing pinger service] *****************************************
ok: [binary0ne-2]

TASK [pinger : Create pinger config folder] ************************************
ok: [binary0ne-2]

TASK [pinger : Upload pinger config] *******************************************
ok: [binary0ne-2]

PLAY [telegraf] ****************************************************************

TASK [telegraf : Add telegraf key] *********************************************
ok: [binary0ne-2]

TASK [telegraf : add telegraf repo] ********************************************
ok: [binary0ne-2]

TASK [telegraf : Install telegraf] *********************************************
ok: [binary0ne-2]

TASK [telegraf : Upload telegraf config] ***************************************
ok: [binary0ne-2]

PLAY [rsyslog logging] *********************************************************

TASK [rsyslog : Setup rsyslog] *************************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

PLAY RECAP *********************************************************************
binary0ne-1                : ok=62   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
binary0ne-2                : ok=63   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
binary0ne-3                : ok=61   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

+ ansible all -b -m reboot -a test_command=uptime
binary0ne-2 | CHANGED => {
    "changed": true,
    "elapsed": 34,
    "rebooted": true
}
binary0ne-1 | CHANGED => {
    "changed": true,
    "elapsed": 36,
    "rebooted": true
}
binary0ne-3 | CHANGED => {
    "changed": true,
    "elapsed": 36,
    "rebooted": true
}
+ ansible-playbook infra.yaml --diff

PLAY [Operations on local machine] *********************************************

PLAY [Swap db master and slave] ************************************************

PLAY [Gather facts] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [binary0ne-2]
ok: [binary0ne-3]
ok: [binary0ne-1]

PLAY [Remote hosts setup] ******************************************************

TASK [remote_hosts : Update and upgrade apt packages] **************************
ok: [binary0ne-2]
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [remote_hosts : Update CA certificates] ***********************************
ok: [binary0ne-2]
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [node_exporter : Installing Prometheus node exporter] *********************
ok: [binary0ne-2]
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [backup : Add backup group] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [backup : Add backup user] ************************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [backup : Ensure .ssh exists] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Generate keypair] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [backup : Change ownership] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Add SSH keys for users] *****************************************
ok: [binary0ne-3]
ok: [binary0ne-1]
ok: [binary0ne-2]

TASK [backup : Add to known hosts] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [backup : Ensure restore folder is created] *******************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [backup : Install duplicity] **********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [DNS server] **************************************************************

TASK [bind : Install bind] *****************************************************
ok: [binary0ne-2]
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [bind : Install python dependencies] **************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

TASK [bind : Update bind config] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [bind : Creates zone directory] *******************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [Provide initial dns config] **********************************************

TASK [nsstaticconf : Update zones config] **************************************
ok: [binary0ne-2]

TASK [nsstaticconf : Update reverse config] ************************************
ok: [binary0ne-2]

PLAY [Update ns records] *******************************************************

TASK [nsstaticconf : Update zones config] **************************************
ok: [binary0ne-2]

TASK [nsstaticconf : Update reverse config] ************************************
ok: [binary0ne-2]

TASK [nsupdate : Prepare vars] *************************************************
ok: [binary0ne-2 -> localhost]

TASK [nsupdate : Add new hosts] ************************************************
ok: [binary0ne-2]

TASK [nsupdate : Install python dependencies] **********************************
ok: [binary0ne-2]

TASK [nsupdate : Add dns records] **********************************************
ok: [binary0ne-2] => (item={'name': 'backup', 'address': '192.168.42.132', 'type': 'A'})
ok: [binary0ne-2] => (item={'name': 'grafana', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'influxdb', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'lb1', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'lb2', 'address': 'binary0ne-3', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'mysql1', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'mysql2', 'address': 'binary0ne-3', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'ns1', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'ns2', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'ns3', 'address': 'binary0ne-3', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'prometheus', 'address': 'binary0ne-2', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'web1', 'address': 'binary0ne-1', 'type': 'CNAME'})
ok: [binary0ne-2] => (item={'name': 'web2', 'address': 'binary0ne-3', 'type': 'CNAME'})

PLAY [Update for dns server] ***************************************************

TASK [remote_network : Updating DNS server path] *******************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [Nginx for monitoring] ****************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [binary0ne-2]

TASK [nginx : Upload nginx config] *********************************************
ok: [binary0ne-2]

PLAY [Grafana] *****************************************************************

TASK [docker : Install docker (and save the God all of us!)] *******************
ok: [binary0ne-2]

TASK [docker : Install pyhon3-docker] ******************************************
ok: [binary0ne-2]

TASK [grafana : Get grafana structure vars] ************************************
ok: [binary0ne-2]

TASK [grafana : Get public ips] ************************************************
ok: [binary0ne-2]

TASK [grafana : Create grafana directories] ************************************
ok: [binary0ne-2] => (item=provisioning/dashboards)
ok: [binary0ne-2] => (item=provisioning/datasources)

TASK [grafana : Create grafana files] ******************************************
ok: [binary0ne-2] => (item=grafana.ini)
ok: [binary0ne-2] => (item=provisioning/dashboards/provisioning.yaml)
ok: [binary0ne-2] => (item=provisioning/dashboards/main.json)
ok: [binary0ne-2] => (item=provisioning/dashboards/mysql.json)
ok: [binary0ne-2] => (item=provisioning/datasources/default.yaml)

TASK [grafana : Create grafana container] **************************************
ok: [binary0ne-2]

PLAY [Prometheus] **************************************************************

TASK [prometheus : Get variables] **********************************************
ok: [binary0ne-2]

TASK [prometheus : Install prometheus] *****************************************
ok: [binary0ne-2]

TASK [prometheus : Update prometheus config] ***********************************
ok: [binary0ne-2]

TASK [prometheus : Fix prometheus path] ****************************************
ok: [binary0ne-2]

PLAY [Database server] *********************************************************

TASK [mysql : Install MySQL] ***************************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql : Upload MySQL config] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql : Install dependencies for ansible] ********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql : Read only for slaves] ********************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [mysql : MySQL database] **************************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql : agama MySQL user] ************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [mysql : replication MySQL user] ******************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_backup : Ensure backup folder is created] **************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_backup : Create mysql backup user] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_backup : Upload mysql backup user config] **************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_backup : Upload crontab for agama backup] **************************
ok: [binary0ne-1]
ok: [binary0ne-3]

PLAY [Web server] **************************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [nginx : Upload nginx config] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [docker : Install docker (and save the God all of us!)] *******************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [docker : Install pyhon3-docker] ******************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [agama : Get agama structure vars] ****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [agama : Create Agama Folder] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [agama : Get Agama] *******************************************************
ok: [binary0ne-3] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [binary0ne-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [binary0ne-3] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/Dockerfile)
ok: [binary0ne-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/Dockerfile)

TASK [agama : Build agama] *****************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [agama : Run agama container] *********************************************
ok: [binary0ne-1] => (item=0)
ok: [binary0ne-3] => (item=0)
ok: [binary0ne-1] => (item=1)
ok: [binary0ne-3] => (item=1)

TASK [keepalived : Install keepalived] *****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Add group] **************************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [keepalived : Add user for scripts] ***************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Upload script] **********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Upload keepalived config] ***********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Download keepalived-exporter] *******************************
ok: [binary0ne-3]
ok: [binary0ne-1]

TASK [keepalived : Put exporter to bin folder] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [keepalived : Placing keepalived-exporter service] ************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Load agama vars] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Install HAproxy] ***********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Upload haproxy config] *****************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Install haproxy exporter] **************************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [haproxy : Provide haproxy config] ****************************************
ok: [binary0ne-3]
ok: [binary0ne-1]

PLAY [DB monitoring] ***********************************************************

TASK [mysql_exporter : Install mysql exporter] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Add slave status exporter] ******************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Create mysql monitoring user] ***************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Upload mysql exporter config] ***************************
ok: [binary0ne-1]
ok: [binary0ne-3]

TASK [mysql_exporter : Wait for mysql] *****************************************
Pausing for 20 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [binary0ne-1]

TASK [mysql_exporter : Start mysql exporter] ***********************************
ok: [binary0ne-1]
ok: [binary0ne-3]

PLAY [DNS monitoring] **********************************************************

TASK [bind_exporter : Install bind exporter] ***********************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [Nginx monitoring] ********************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [nginx : Upload nginx config] *********************************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

TASK [nginx_exporter : Install nginx exporter] *********************************
ok: [binary0ne-1]
ok: [binary0ne-3]
ok: [binary0ne-2]

PLAY [InfluxDB] ****************************************************************

TASK [influxdb : Install influxdb] *********************************************
ok: [binary0ne-2]

TASK [influxdb : Start influxdb] ***********************************************
ok: [binary0ne-2]

TASK [influxdb : Upload influxdb config] ***************************************
ok: [binary0ne-2]

TASK [influxdb_backup : Ensure backup folder is created] ***********************
ok: [binary0ne-2]

TASK [influxdb_backup : Upload crontab for influxdb backup] ********************
ok: [binary0ne-2]

PLAY [Influxdb-exporter] *******************************************************

TASK [influxdb_exporter : download influxdb exporter] **************************
ok: [binary0ne-2]

TASK [influxdb_exporter : set mode for influx exporter] ************************
ok: [binary0ne-2]

TASK [influxdb_exporter : upload service template for influxdb exporter] *******
ok: [binary0ne-2]

PLAY [pinger] ******************************************************************

TASK [pinger : Ensure group pinger exists] *************************************
ok: [binary0ne-2]

TASK [pinger : Add pinger user] ************************************************
ok: [binary0ne-2]

TASK [pinger : Install dependency] *********************************************
ok: [binary0ne-2]

TASK [pinger : Placing pinger script] ******************************************
ok: [binary0ne-2]

TASK [pinger : Placing pinger service] *****************************************
ok: [binary0ne-2]

TASK [pinger : Create pinger config folder] ************************************
ok: [binary0ne-2]

TASK [pinger : Upload pinger config] *******************************************
ok: [binary0ne-2]

PLAY [telegraf] ****************************************************************

TASK [telegraf : Add telegraf key] *********************************************
ok: [binary0ne-2]

TASK [telegraf : add telegraf repo] ********************************************
ok: [binary0ne-2]

TASK [telegraf : Install telegraf] *********************************************
ok: [binary0ne-2]

TASK [telegraf : Upload telegraf config] ***************************************
ok: [binary0ne-2]

PLAY [rsyslog logging] *********************************************************

TASK [rsyslog : Setup rsyslog] *************************************************
ok: [binary0ne-1]
ok: [binary0ne-2]
ok: [binary0ne-3]

PLAY RECAP *********************************************************************
binary0ne-1                : ok=62   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
binary0ne-2                : ok=63   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
binary0ne-3                : ok=61   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

+ date
Mon Dec 12 01:48:45 EET 2022
